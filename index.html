<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZAC-MAN: Operations Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --zalando-orange: #ff6900;
            --zalando-black: #1a1a1a;
            --neon-blue: #00ffff;
            --neon-pink: #ff00ff;
            --neon-green: #39ff14;
            --text-main: #ffffff;
            --sidebar-bg: #222;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--zalando-black);
            color: var(--text-main);
            font-family: 'Press Start 2P', cursive; 
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
            font-size: 12px;
        }

        /* --- LAYOUT --- */
        #main-wrapper {
            display: flex;
            width: 100%;
            height: 100%;
        }

        /* SIDEBAR */
        #sidebar {
            width: 380px;
            background-color: var(--sidebar-bg);
            border-right: 4px solid var(--zalando-orange);
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            z-index: 100;
            line-height: 1.8;
        }

        #game-area {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background-color: #000;
            background-image: radial-gradient(#333 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* TYPOGRAPHY */
        h1 {
            color: var(--zalando-orange);
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 3px 3px #000;
            line-height: 1.4;
        }
        .subtitle {
            font-size: 0.6rem;
            color: #888;
            margin-bottom: 30px;
            letter-spacing: 1px;
        }

        h2 { 
            font-size: 0.8rem; 
            color: var(--neon-blue); 
            margin-top: 20px; 
            margin-bottom: 15px;
            border-bottom: 2px dashed #444; 
            padding-bottom: 10px;
            line-height: 1.5;
        }
        
        p, li { 
            font-size: 0.6rem;
            color: #ccc; 
            margin-bottom: 15px; 
            text-align: justify;
        }
        strong { color: var(--zalando-orange); }
        
        .info-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border: 2px solid #444;
            margin-bottom: 20px;
            box-shadow: 3px 3px 0px #000;
        }

        /* NAVIGAZIONE */
        .controls-nav {
            margin-top: auto;
            display: flex;
            flex-direction: row;
            gap: 10px;
            width: 100%;
            align-items: center;
            padding-top: 20px;
            border-top: 2px dashed #444;
        }

        button {
            background: #444;
            color: white;
            border: 2px solid #888;
            padding: 12px 10px;
            cursor: pointer;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.5rem;
            flex: 1;
            transition: all 0.1s;
            box-shadow: 0 4px 0 #222;
            text-align: center;
            line-height: 1.4;
        }
        button:active { transform: translateY(4px); box-shadow: 0 0 0 #222; }
        button:hover { background: #666; border-color: #aaa; }
        
        button.primary { 
            background: var(--zalando-orange); 
            color: black; 
            border-color: #ff9933;
            box-shadow: 0 4px 0 #994000;
        }
        button.primary:hover { background: #ff8533; }
        button.primary:active { box-shadow: 0 0 0 #994000; }

        /* MEGA START BUTTON STYLES */
        .btn-mega {
            background: #000;
            color: var(--zalando-orange);
            border: 6px solid var(--zalando-orange);
            padding: 25px 50px;
            font-size: 1.2rem;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            margin-top: 40px;
            position: relative;
            text-transform: uppercase;
            box-shadow: 
                0 0 10px var(--zalando-orange),
                inset 0 0 20px rgba(255, 105, 0, 0.5);
            transition: all 0.2s ease-in-out;
            animation: pulse-glow 2s infinite;
        }

        .btn-mega:hover {
            background: var(--zalando-orange);
            color: #000;
            box-shadow: 0 0 50px var(--zalando-orange);
            transform: scale(1.05);
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 10px var(--zalando-orange); }
            50% { box-shadow: 0 0 30px var(--zalando-orange), 0 0 50px var(--zalando-orange); }
            100% { box-shadow: 0 0 10px var(--zalando-orange); }
        }

        /* ARCADE SCREEN */
        #arcade-screen {
            position: relative;
            border: 10px solid #333;
            border-radius: 4px;
            box-shadow: 0 0 40px rgba(255, 105, 0, 0.2);
            background: black;
            overflow: hidden;
            width: 600px;
            height: 600px;
            max-width: 95vw;
            max-height: 95vw;
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* OVERLAYS */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.92);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 30px;
            z-index: 10;
        }
        .hidden { display: none !important; }

        .overlay h2 { 
            font-size: 1.2rem; 
            color: var(--neon-blue); 
            margin-bottom: 30px; 
            text-shadow: 2px 2px var(--zalando-orange);
        }
        
        .lesson-box {
            border: 4px double white; 
            padding: 20px 20px 20px 40px;
            margin: 20px 0; 
            background: #111;
            width: 90%;
            text-align: left;
            line-height: 1.8;
            font-size: 0.6rem;
            color: #ddd;
        }

        .overlay p { 
            font-size: 0.7rem; 
            color: #fff; 
            max-width: 90%; 
            line-height: 1.8; 
            margin-bottom: 20px;
        }
        
        .overlay button.primary {
            width: auto;
            min-width: 200px;
            font-size: 0.8rem;
            padding: 15px;
            margin-top: 20px;
        }

        /* RESPONSIVE */
        @media (max-width: 900px) {
            #main-wrapper { flex-direction: column-reverse; }
            #sidebar { width: 100%; height: 40%; border-right: none; border-top: 4px solid var(--zalando-orange); }
            #game-area { height: 60%; }
        }

        /* MOBILE CONTROLS */
        #mobile-controls {
            position: absolute; bottom: 20px; right: 20px;
            display: none; flex-direction: column; align-items: center; gap: 10px; z-index: 50;
        }
        .d-row { display: flex; gap: 60px; }
        .d-btn {
            width: 60px; height: 60px;
            background: rgba(255,255,255,0.1);
            border: 4px solid rgba(255,255,255,0.3); 
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; color: white; user-select: none;
            box-shadow: 0 4px 0 rgba(0,0,0,0.5);
        }
        .d-btn:active { background: var(--zalando-orange); transform: translateY(4px); box-shadow: none; }
    </style>
</head>
<body>

<div id="main-wrapper">
    
    <!-- SIDEBAR -->
    <div id="sidebar">
        <h1>ZAC-MAN</h1>
        <div class="subtitle">OPERATIONS EDITION</div>

        <div class="info-box">
            <h2>Cos'e' NotebookLM?</h2>
            <p><strong>NOTE:</strong> Non e' un plugin. E' una Web App esterna.</p>
            <p>E' il tuo <strong>Research Assistant</strong>. Carica PDF, Slide o Link e lui diventa un esperto istantaneo.</p>
            <p style="font-size:0.5rem; color:#666; margin-top:10px;">URL: notebooklm.google.com</p>
        </div>

        <div class="info-box">
            <h2>Missione</h2>
            <p>Il Drive e' pieno di <strong>Fantasmi</strong> (Documenti).</p>
            <ul>
                <li>Usa le Frecce.</li>
                <li>Mangia le Fonti.</li>
                <li>Sblocca le Lezioni.</li>
            </ul>
        </div>

        <div class="controls-nav">
            <button onclick="prevLevel()">&lt; PREV</button>
            <button onclick="resetGame()">RESET</button>
            <button class="primary" onclick="window.open('https://notebooklm.google.com', '_blank')">OPEN APP &gt;</button>
        </div>
    </div>

    <!-- AREA GIOCO -->
    <div id="game-area">
        <div id="arcade-screen">
            <canvas id="gameCanvas" width="600" height="600"></canvas>
            
            <div id="start-screen" class="overlay">
                <h2 style="color:var(--zalando-orange); font-size: 2rem; margin-bottom: 20px;">ZAC-MAN</h2>
                <div style="margin:20px;">
                     <!-- ZACMAN IMAGE RESTORED - Make sure file is named zacman.png -->
                     <img src="zacman.png" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0iI2ZmNjkwMCIvPjwvc3ZnPg=='" style="width: 100px; height: 100px; animation: bounce 1s infinite alternate;">
                </div>
                <p style="margin-top: 10px; color: #aaa;">OPERATIONS EDITION</p>
                
                <button class="btn-mega" onclick="startGame()">
                    INSERT COIN
                </button>
            </div>

            <div id="level-screen" class="overlay hidden">
                <h2 id="level-title">LEVEL CLEARED!</h2>
                <p id="level-msg">...</p>
                <div class="lesson-box">
                    <p id="level-lesson" style="color: #00ffff; margin:0;">...</p>
                </div>
                <button class="primary" onclick="nextLevel()">NEXT FEATURE &gt;&gt;</button>
            </div>

            <div id="victory-screen" class="overlay hidden">
                <h2 style="color: var(--zalando-orange); font-size: 1.5rem; margin-bottom: 20px;">HAI FATTO IL RESTYLING AL CAOS!</h2>
                
                <p style="font-size: 0.8rem; line-height: 1.5; margin-bottom: 20px;">
                    Non sei pi√π solo un "Operator".<br>
                    Sei un <span style="color: var(--neon-blue);">KNOWLEDGE DESIGNER</span>.
                </p>
                
                <div class="lesson-box" style="border-color: var(--zalando-orange); text-align: center; padding: 15px;">
                    <p style="margin-bottom: 15px; color: var(--zalando-orange);">IL TUO NUOVO TOOLKIT:</p>
                    <p>üß† <strong>Cervello:</strong> Sintesi immediate</p>
                    <p>üëÅÔ∏è <strong>Occhio:</strong> Mappe & Infografiche</p>
                    <p>üé¨ <strong>Regia:</strong> Script Video & Audio</p>
                </div>
                
                <p style="font-size: 0.7rem; color: #aaa; margin-top: 10px; font-style: italic;">
                    "Dati grezzi in entrata.<br>Strategia pura in uscita."
                </p>
                
                <button class="primary" onclick="resetGame()">GIOCA ANCORA</button>
            </div>

            <div id="mobile-controls">
                <div class="d-btn" ontouchstart="handleTouch('up')">‚ñ≤</div>
                <div class="d-row">
                    <div class="d-btn" ontouchstart="handleTouch('left')">‚óÄ</div>
                    <div class="d-btn" ontouchstart="handleTouch('right')">‚ñ∂</div>
                </div>
                <div class="d-btn" ontouchstart="handleTouch('down')">‚ñº</div>
            </div>
        </div>
    </div>
</div>

<script>
/**
 * ZAC-MAN ENGINE - TARGET BASED MOVEMENT (ROBUST)
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let animationId;

// --- CONFIG ---
const COLS = 20;
const ROWS = 20;
const TILE_SIZE = 30; 

// --- STATE ---
let gameState = 'start'; 
let currentLevel = 1;
let ghosts = [];
let player = { x: 1, y: 1, dirX: 0, dirY: 0, nextDirX: 0, nextDirY: 0, speed: 0.15, angle: 0 };

// 1=Muro, 0=Vuoto
const mapDesign = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,1,0,1,1,0,1,0,1,1,0,1,1,1,0,0,1],
    [1,0,1,1,1,0,1,1,0,1,0,1,1,0,1,1,1,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,0,1,1,1,1,1,1,0,1,0,1,1,0,1],
    [1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1],
    [1,1,1,1,0,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1],
    [1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
    [1,0,1,1,0,1,0,1,1,0,0,1,0,1,0,1,1,0,0,1], 
    [1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,0,1,1,1,1,1,1,0,1,0,1,1,0,1],
    [1,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,1],
    [1,1,0,1,0,1,1,1,0,1,0,1,1,1,1,0,1,0,1,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,1,0,1,1,0,1,0,1,1,0,1,1,1,0,0,1],
    [1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],
    [1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

// UPDATED GHOST TYPES based on Guide
const GHOST_TYPES = [
    { name: "PDF", color: "#e74c3c", label: "PDF" },
    { name: "DOC", color: "#3498db", label: "DOC" },
    { name: "WEB", color: "#2ecc71", label: "WEB" },
    { name: "SLIDE", color: "#f1c40f", label: "SLIDE" },
    { name: "YT", color: "#9b59b6", label: "YT" }
];

// --- INIT ---
function init() {
    window.addEventListener('resize', resizeCanvas);
    requestAnimationFrame(gameLoop);
    if('ontouchstart' in window) {
        document.getElementById('mobile-controls').style.display = 'flex';
    }
}

function resizeCanvas() {
    // Canvas resolution is fixed 600x600 via HTML props
}

function initLevel(level) {
    player.x = 1; player.y = 1;
    player.dirX = 0; player.dirY = 0;
    player.nextDirX = 0; player.nextDirY = 0;

    ghosts = [];
    let count = 2 + level; 
    
    for (let i = 0; i < count; i++) {
        spawnGhost(i);
    }
}

function spawnGhost(index) {
    let placed = false;
    let attempts = 0;
    while (!placed && attempts < 100) {
        let rx = Math.floor(Math.random() * COLS);
        let ry = Math.floor(Math.random() * ROWS);
        
        // Spawn solo in spazi vuoti e lontano dal player
        if (mapDesign[ry][rx] === 0 && (Math.abs(rx - player.x) > 6)) {
            let type = GHOST_TYPES[index % GHOST_TYPES.length];
            
            // Per il sistema Target, inizializziamo target = posizione attuale
            ghosts.push({
                x: rx, 
                y: ry, 
                targetX: rx,
                targetY: ry,
                dirX: 0,
                dirY: 0,
                type: type,
                speed: 0.05 + (0.01 * currentLevel) // Slow but steady
            });
            placed = true;
        }
        attempts++;
    }
}

// --- LOGIC ---
function isWall(x, y) {
    if (y < 0 || y >= ROWS || x < 0 || x >= COLS) return true;
    return mapDesign[Math.floor(y)][Math.floor(x)] === 1;
}

function update() {
    if (gameState !== 'playing') return;

    // 1. PLAYER MOVEMENT
    const centerX = Math.floor(player.x + 0.5);
    const centerY = Math.floor(player.y + 0.5);
    const dist = Math.abs(player.x - centerX) + Math.abs(player.y - centerY);

    if (dist < 0.2) { 
        if (player.nextDirX !== 0 || player.nextDirY !== 0) {
            if (!isWall(centerX + player.nextDirX, centerY + player.nextDirY)) {
                player.x = centerX; player.y = centerY;
                player.dirX = player.nextDirX; player.dirY = player.nextDirY;
                player.nextDirX = 0; player.nextDirY = 0;
            }
        }
        if (isWall(centerX + player.dirX, centerY + player.dirY)) {
            player.dirX = 0; player.dirY = 0;
        }
    }
    player.x += player.dirX * player.speed;
    player.y += player.dirY * player.speed;
    
    // Angle
    if (player.dirX === 1) player.angle = 0;
    else if (player.dirX === -1) player.angle = Math.PI;
    else if (player.dirY === -1) player.angle = -Math.PI/2;
    else if (player.dirY === 1) player.angle = Math.PI/2;

    // 2. GHOST MOVEMENT (TARGET BASED - INFALLIBLE)
    ghosts.forEach(ghost => {
        // Calcola distanza dal target
        const dx = ghost.targetX - ghost.x;
        const dy = ghost.targetY - ghost.y;
        const distToTarget = Math.sqrt(dx*dx + dy*dy);

        // Se siamo molto vicini al target (o ci siamo sopra), scegliamo il prossimo
        if (distToTarget <= ghost.speed) {
            // Snap esatto alla tile per evitare drift
            ghost.x = ghost.targetX;
            ghost.y = ghost.targetY;
            
            // Dove possiamo andare da qui?
            const gx = ghost.x;
            const gy = ghost.y;
            let possible = [];

            if (!isWall(gx+1, gy)) possible.push({x: gx+1, y: gy, dx: 1, dy: 0});
            if (!isWall(gx-1, gy)) possible.push({x: gx-1, y: gy, dx: -1, dy: 0});
            if (!isWall(gx, gy+1)) possible.push({x: gx, y: gy+1, dx: 0, dy: 1});
            if (!isWall(gx, gy-1)) possible.push({x: gx, y: gy-1, dx: 0, dy: -1});

            if (possible.length > 0) {
                // Filtra per non tornare indietro immediatamente (se possibile)
                // Usiamo ghost.dirX/Y per sapere da dove veniamo
                let forward = possible.filter(p => !(p.dx === -ghost.dirX && p.dy === -ghost.dirY));
                
                let chosen;
                if (forward.length > 0) {
                     // Scegli a caso tra le opzioni "avanti"
                    chosen = forward[Math.floor(Math.random() * forward.length)];
                } else {
                    // Vicolo cieco, torna indietro
                    chosen = possible[0];
                }
                
                // Imposta nuovo target
                ghost.targetX = chosen.x;
                ghost.targetY = chosen.y;
                ghost.dirX = chosen.dx;
                ghost.dirY = chosen.dy;
            } else {
                // Intrappolato (non dovrebbe succedere)
            }
            
        } else {
            // Muoviti verso il target
            ghost.x += Math.sign(dx) * ghost.speed;
            ghost.y += Math.sign(dy) * ghost.speed;
        }
    });

    // 3. EATING
    for (let i = ghosts.length - 1; i >= 0; i--) {
        const g = ghosts[i];
        const dx = player.x - g.x;
        const dy = player.y - g.y;
        if (Math.sqrt(dx*dx + dy*dy) < 0.9) { 
            ghosts.splice(i, 1);
        }
    }

    if (ghosts.length === 0) endLevel();
}

// --- DRAW ---
function draw() {
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    const ts = canvas.width / COLS;

    // Map
    ctx.fillStyle = "#2c3e50";
    for (let y=0; y<ROWS; y++) {
        for (let x=0; x<COLS; x++) {
            if (mapDesign[y][x] === 1) {
                ctx.fillStyle = "#333";
                ctx.fillRect(x*ts, y*ts, ts, ts);
                ctx.strokeStyle = "var(--zalando-orange)";
                ctx.lineWidth = 1;
                ctx.strokeRect(x*ts+4, y*ts+4, ts-8, ts-8);
            }
        }
    }

    // Ghosts
    ghosts.forEach(g => {
        let gx = g.x * ts + ts/2;
        let gy = g.y * ts + ts/2;
        ctx.fillStyle = g.type.color;
        ctx.beginPath();
        ctx.arc(gx, gy-2, ts*0.4, Math.PI, 0, false);
        ctx.lineTo(gx+ts*0.4, gy+ts*0.4);
        ctx.lineTo(gx-ts*0.4, gy+ts*0.4);
        ctx.fill();
        ctx.fillStyle = "black";
        ctx.font = "bold 10px Arial";
        ctx.textAlign = "center";
        ctx.fillText(g.type.label, gx, gy+4);
    });

    // Player
    let px = player.x * ts + ts/2;
    let py = player.y * ts + ts/2;
    ctx.save();
    ctx.translate(px, py);
    ctx.rotate(player.angle);
    ctx.fillStyle = "#ff6900";
    ctx.beginPath();
    let mouth = Math.abs(Math.sin(Date.now()/100)) * 0.2 + 0.05;
    ctx.arc(0, 0, ts*0.45, mouth*Math.PI, (2-mouth)*Math.PI);
    ctx.lineTo(0,0);
    ctx.fill();
    ctx.restore();
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

// --- UI CONTROL ---
function startGame() {
    document.getElementById('start-screen').classList.add('hidden');
    currentLevel = 1;
    gameState = 'playing';
    initLevel(1);
}

function resetGame() {
    document.querySelectorAll('.overlay').forEach(el => el.classList.add('hidden'));
    document.getElementById('start-screen').classList.remove('hidden');
    gameState = 'start';
}

function prevLevel() {
    if (currentLevel > 1) {
        currentLevel--;
        document.getElementById('level-screen').classList.add('hidden');
        document.getElementById('victory-screen').classList.add('hidden');
        gameState = 'playing';
        initLevel(currentLevel);
    } else {
        resetGame();
    }
}

// --- SPECIFIC LESSON OUTCOMES ---
function endLevel() {
    gameState = 'level_transition';
    const screen = document.getElementById('level-screen');
    const title = document.getElementById('level-title');
    const msg = document.getElementById('level-msg');
    const lesson = document.getElementById('level-lesson');

    screen.classList.remove('hidden');

    if (currentLevel === 1) {
        // LEZIONE 1: INGESTION (FONTI)
        title.innerHTML = "FONTI ACQUISITE!";
        msg.innerHTML = "Hai centralizzato la conoscenza.";
        lesson.innerHTML = "<strong>LESSON 1: VARIETA' DELLE FONTI</strong><br><br>NotebookLM supporta fino a 50 fonti: PDF, Google Doc, Slide, Link Web, Testo copiato, Audio e YouTube. √à la tua 'Single Source of Truth' per ogni progetto.";
    } else if (currentLevel === 2) {
        // LEZIONE 2: GROUNDING & CHAT
        title.innerHTML = "VERIFICA COMPLETATA!";
        msg.innerHTML = "Hai eliminato le allucinazioni.";
        lesson.innerHTML = "<strong>LESSON 2: GROUNDING & CITAZIONI</strong><br><br>La chat risponde SOLO basandosi sulle tue fonti. Ogni risposta ha numeri [1] cliccabili (citazioni) che ti portano al passaggio esatto del documento originale.";
    } else if (currentLevel === 3) {
        // LEZIONE 3: ELABORAZIONE (NOTE & SINTESI)
        title.innerHTML = "SINTESI CREATA!";
        msg.innerHTML = "Hai trasformato i dati in valore.";
        lesson.innerHTML = "<strong>LESSON 3: FORMATI DI OUTPUT</strong><br><br>Non solo chat: salva le risposte come Note. Chiedi a NotebookLM di creare per te FAQ, Briefing Doc, Tabelle Cronologiche o Guide allo Studio basate sulle tue fonti.";
    } else if (currentLevel === 4) {
        // LEZIONE 4: MULTIMODALE (AGGIORNATA: SPRINT & FANTASIA)
        title.innerHTML = "FANTASIA AL POTERE!";
        title.style.color = "var(--neon-pink)";
        msg.innerHTML = "Oltre il testo: dai voce e colore ai dati.";
        lesson.innerHTML = "<strong style='color:var(--neon-green);'>LESSON 4: MULTIMODAL CREATIVITY</strong><br><br>Non solo leggere: <strong>Ascolta</strong> i report (Audio), crea <strong>Mappe Mentali</strong> per visualizzare i concetti e chiedi <strong>Script per Video</strong> o Infografiche. Trasforma le slide noiose in uno show.";
    }
}

function nextLevel() {
    document.getElementById('level-screen').classList.add('hidden');
    currentLevel++;
    if (currentLevel > 4) { // Now 4 levels
        document.getElementById('victory-screen').classList.remove('hidden');
    } else {
        gameState = 'playing';
        initLevel(currentLevel);
    }
}

// Input Handling
window.addEventListener('keydown', e => {
    if(gameState !== 'playing') return;
    if(e.key === 'ArrowUp') { player.nextDirX = 0; player.nextDirY = -1; }
    if(e.key === 'ArrowDown') { player.nextDirX = 0; player.nextDirY = 1; }
    if(e.key === 'ArrowLeft') { player.nextDirX = -1; player.nextDirY = 0; }
    if(e.key === 'ArrowRight') { player.nextDirX = 1; player.nextDirY = 0; }
});

function handleTouch(dir) {
    if(gameState !== 'playing') return;
    if(dir === 'up') { player.nextDirX = 0; player.nextDirY = -1; }
    if(dir === 'down') { player.nextDirX = 0; player.nextDirY = 1; }
    if(dir === 'left') { player.nextDirX = -1; player.nextDirY = 0; }
    if(dir === 'right') { player.nextDirX = 1; player.nextDirY = 0; }
}

init();

</script>
</body>
</html>
